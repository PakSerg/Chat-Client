<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type = "text/javascript" src = "/eel.js"></script> 
    <title>Чат</title>
</head>
<body>
    <div class="chat-window">
        <h1>Чат</h1>
        <div>Ваш ID: <span id="userID">0</span></div>
        <div id="chat"></div>
        <input type="text" id="message" placeholder="Введите сообщение">
        <button id="sendButton" onclick="sendMessage()">Отправить</button>
    </div>

    <div class="sign-up-window">
        <h1>Регистрация</h1>
        <input type="text" id="sign-up-name" placeholder="Введите логин">
        <input type="text" id="sign-up-password" placeholder="Введите пароль">
        <button id="sendButton" onclick="signUp()">Зарегаться</button>
    </div>

    <div class="log-in-window">
        <h1>Вход</h1>
        <input type="text" id="log-in-name" placeholder="Введите логин">
        <input type="text" id="log-in-password" placeholder="Введите пароль">
        <button id="sendButton" onclick="logIn()">Войти</button>
    </div>

    <script>
        toggleChatWindow();

        eel.expose(toggleChatWindow)
        function toggleChatWindow() {
            var chatWindow = document.querySelector('.chat-window');
            if (chatWindow.style.display === 'none') {
                chatWindow.style.display = 'block';
            } else {
                chatWindow.style.display = 'none';
            }
        }

        eel.expose(toggleSignUpWindow)
        function toggleSignUpWindow() {
            var signUpWindow = document.querySelector('.sign-up-window');
            if (signUpWindow.style.display === 'none') {
                signUpWindow.style.display = 'block';
            } else {
                signUpWindow.style.display = 'none';
            }
        }

        eel.expose(toggleLogInWindow)
        function toggleLogInWindow() {
            var logInWindow = document.querySelector('.log-in-window');
            if (logInWindow.style.display === 'none') {
                logInWindow.style.display = 'block';
            } else {
                logInWindow.style.display = 'none';
            }
        }

        // document.getElementById('message').onkeypress = function(e) {
        //     if (e.keyCode === 13) {
        //         document.getElementById('sendButton').click();
        //     }
        // };

        eel.expose(addMessageToChat);
        function addMessageToChat(message_content, message_time, message_author) {
            
            document.getElementById('chat').innerHTML += `<p>[${message_author} ${message_time}]: ${message_content}</p>`; 
        }
        
        eel.expose(loadChatHistory);
        function loadChatHistory(messages) {
            var chatElement = document.getElementById('chat');

            messages.forEach(function(message) {
                var messageTime = message.time;
                var messageContent = message.content;
                var messageAuthor = message.username;

                var messageHTML = `<p>[${messageAuthor} ${messageTime}]: ${messageContent}</p>`;
                chatElement.innerHTML += messageHTML;
            });
        }


        function signUp() {
            var name = document.getElementById('sign-up-name').value;
            var password = document.getElementById('sign-up-password').value;

            eel.sign_up(name, password);

            document.getElementById('sign-up-name').value = '';
            document.getElementById('sign-up-password').value = '';
        }


        function logIn() {
            var name = document.getElementById('log-in-name').value;
            var password = document.getElementById('log-in-password').value;

            eel.log_in(name, password);

            document.getElementById('log-in-name').value = '';
            document.getElementById('log-in-password').value = '';
        }

        
        function sendMessage() {
            var userID = parseInt(document.getElementById('userID').innerText);
            var message = document.getElementById('message').value;

            eel.send_message_to_server(message, userID);
            document.getElementById('message').value = '';
        }

        eel.expose(loadUserID)
        function loadUserID(user_id) {
            document.getElementById('userID').innerText = user_id
        }
    </script>

</body>
</html>



